![[5.3.0.jpg]]
**Recap: 
Proper log management 
1. Ensuring ogs are protected through detailed recording of changes
2. Storing logs for a sufficient amount of time 
3. Omitting unnecessary data to avoid excessive and gratuitous logs

Log management looks like?
1. Investigate an issue 
	1. Ex: Applying log filters during log review to scope out past or current events
		1. Log Filter is a tool for extracting specific information from a log
2. Size management 
	1. Creating a log size management system that rotates logs to preserve log entries and keep log files size manageable
	2. Log rotation is closing, dating, and moving log to another location, and replacing them with empty files 	
3. Audit
	1. Installing and configuring a log system that audits system file changes and record those changes to disk as audit recording**

**proper log management:**
1. Ensuring logs are protected through detailed recording of changes
2. storing logs for a sufficient amount of time
3. omitting unnecessary data to avoid excessive and gratuities logs 

![[5.3.0 1.jpg]]

![[5.3.2.jpg]]
- Logs are found in /var/log -> It is the default
	- Logs can be anywhere on the computer 
- Highlighted = authorized users 
	- if you use cat/ less / head 
		- It will give you a log of what happened on the system
	- Kern.log 
		- tells you what happen when crashed 
	- mail.log
		- Mail
	- cron.log 
		- Logs of cron jobs 
		- REMEMBER: cron is setting scheduled scripts 

![[5.3.3.jpg]]
**Four Categories of logs
1. Application log: Store alerts generated by software being used by the user, including when it’s launched, how long it’s in use, when it’s closed, etc
2. Event log: Contain information regarding security related events (ex: user succeeded or failed to log onto a host or tries to install unauthorized software)
3. Service logs: Contain information related to system services such as cron jobs and print jobs
4. System log: Contain information regarding system events such as boot message, kernel eros, or anything related to the system hardware**

**How to manage and filter information**
**journalctl** : ![[5.3.4.jpg]]

Journalctl [options]  [information being filtered]
- Journalctl: without filters return the entire (massive) contents of the system lo
- Journalctl --list-boots: Displays lines for each individual boots

![[5.3.5.jpg]]
- Journalctl
	- Tell you the entire massive content of system logs 
- Journalctl --list-boots 
	- Display certain lines 

![[5.3.7.jpg]]
-f : Real time 
-e:
- If you are looking at real time
	- Looking to see if someone is doing something they are not suppose too do 
- To get out, ctrl c

/etc/systemd/journald.conf
- Shows you how you it is logged 


![[5.3.8 1.jpg]]
![[5.3.10.jpg]]
- '#' in front of name = default
- can edit to erase to #

**Lets give someone instructor but wrong password**
$journalclt -ef

su Instructor
![[5.3.11.jpg]]
- This is what you will see in journalclt if someone types in su instructor 
- Shows that failure log in
- NOTE: if you want to target a certain login/ log 
	-  $journalclt -ef | grep 'username/ authentication failure'

**Adding user in Journalclt**
sudo useradd engineer 
![[5.3.12.jpg]]
- What you see in journalclt
- Reason because, we want to see if someone who is not authorized 
	- red team: can create a user under 1000 (root) or any above 1000 to invade the servers 

sudo journalctl -ef

journalctl_UID=[username]

_____
![[5.3.9 1.jpg]]![[5.3.13.jpg]]
![[5.3.16.jpg]]
- Note when you make changes with logs -> auto or non auto
	- You must reset the sysmte by 
	- sudo systemctl restart systemd-journald

![[5.3.17.jpg]]
![[5.3.18.jpg]]
- After all the cmds in number 2 in both terminal 1 and 2 
	- You will see these logs
![[5.3.20.jpg]]
- Yes 
- root, gshadow, 
- UID: sudo
- GUID: shadow group  
______

**Log Size Management**
Log files preserve information regarding system event for a fix period of time
- But Logging daemons cannot control file size

If unchecked, log files can grow to unmanageable sizes that potentially consume all available space 

**Log rotation:** Is the process of archiving a log once it reaches a specific size or a point in a set schedule, and rotating it out with a new, empty log**
![[5.3.22.jpg]]
- Log and store them in different cups instead of buckets 
	- Store is every so often 
- Achieve and rotating it out with a new log file 
	- Load them, save them, send them out, then Remove old ones and making new ones

![[5.3.21.jpg]]
![[5.3.30 1.jpg]]
**[$logrotate]**
- /etc/log.rotate.conf
	- This conf file -
	- This file should not be touch
		- better to have small conf. fukes
____
Example
![[5.3.32.jpg]]
- $sudo cat /etc/logrotate.log 
- weekly - rotate 4
	- Every 4 weeks making a new rotation

![[5.3.33.jpg]]
- dateext - Date extention: not active 
- compress - compress log -> the file will be red 
- file that is white is not compressed file 

NOTE: YOU NEED TO INSTALL LOG ROTATE IN LINUX 
sudo apt install logrotate
![[5.3.34.jpg]]
- NOTE - IF THERE IS NO 'INCLUDE /ETC/LOGROTATE.D' 
	- You will have to create that file 

custom Log
/etc/logrotate

![[5.3.23.jpg]]

![[5.3.24.jpg]]

![[5.3.25 1.jpg]]
____

![[5.3.26 1.jpg]]
![[5.3.26 1.jpg]]
Install log rotate 
-$ sudo apt install logrotate

![[5.3.25 1.jpg]]
Adjust to do not rotate if file is empty

![[5.3.27 2.jpg]]
Looking at log files and their authorization 

cd /etc/logrotate.d/ (custom)
- These are telling how to logrotate 
	- 

`/var/log/auth.log` parameters: `180 days of backlog`, `rotate daily`, `Don't rotate empty logs`, `Compress the file`, `Delay the compression`.
/var/log/auth.log {
    rotate 180
    daily
    notifempty
    compress
    delaycompress
    endscript
}

`/var/log/cron.log` parameters: `60 days of backlog`, `rotate daily`, `Don't rotate empty logs`, `Compress the file`, and `Delay the compression`.
/var/log/cron.log {
    rotate 60
    daily
    notifempty
    compress
    delaycompress
    endscript
}

`/var/log/boot.log` parameters: `30 days of backlog`, `rotate daily`, `Don't rotate empty logs`, `Compress the file`, and `Delay the compression`.
/var/log/boot.log {
    rotate 30
    daily
    notifempty
    compress
    delaycompress
    endscript
}
Test the rotation by forcing Logrotate to rotate the logs by verifying the dates.
    - Run:
	    - sudo logrotate -vf /etc/logrotate.conf
		    - If you see `old log` in the output, run the command again until you see `rotating pattern` in the output.

____

**Log Auditing**
![[5.3.28 1 1.jpg]]
- If anyone modify this file, notify me 
![[5.3.31 1.jpg]]
- programs that will work 
- it will watch - not a cyber security tool
	- It will only tell you that someone modify the file 
![[5.3.29 1.jpg]]


**Auditd**
![[5.3.30 1.jpg]]
Once an even is written to disk, reporting tools such as ausearch, aureport, and aulast are used to generate reports 
- ausearch: tool designed to query [auditd] daemon log based on different search criteria for even-driven log records 
	- [auditd] : snitch of the program 
- aureport: Program that summarizes various types of events
- auditctl: responsible for configuring the [auditd] system
	- Has the capability to enable or disable [auditd] systems 
	- load , list, rules, and generate status reports

![[5.3.29 1.jpg]]
Install auditd
- sudo apt install auditd

Using auditd and looking
- sudo cat /etc/audit/auditd.conf | less
	- Result:
	- ![[3.3.32.jpg]]
		- Conf. file 
			- if you want to change a different log, look at log_file = 
		- Note it is on rotation 

check if there is any rules
$sudo auditctl -l 

How do you make rules
- move into this locaiton
	- /etc/audit/rules.d/auditfules
		- put files in rule.d (rule.d is where you put a custom logs)
		- auditd.conf = default
- sudo nano /etc/audit/rules.d/audit.rules
	- Result 
	- ![[3.3.33 1.jpg]]
	- ![[3.3.34.jpg]]
		- -w: watching what file 
		- /etc/shadow : file being watched
		- -p : permission to monitor
		- wa: write permission, specifies a changes in the file's attribute or ownerships/ permissions 
		- -k: key name for the rule
		- shadow: where is the file in
Need to make result after changes - It will tell you if auditclt is working 
![[3.3.35.jpg]]
$sudo auditctl -l 
- It will show -w /etc/shadow -p wa -k shadow and passwd

Reports 
![[5.3.35.jpg]]
- This will show if someone is trying to log into one of your files 
- [https://sematext.com/glossary/auditd/](https://sematext.com/glossary/auditd/) (how to make rules synax)

**for adding rule for /usr directory**
(to look for a directory)
ls /usr 
- it is in /root 
- -w /root -p rwxa
	- rewrite execute..

![[5.3.28 1.jpg]]


____
![[5.3.31 2.jpg]]



___
